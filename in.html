<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Particle Circle â€” Interactive</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;width:100%;background:#000;overflow:hidden;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;color:#fff}
  button{font-family:inherit}

  .app {
    position:relative;
    width:100vw;height:100vh;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    user-select: none;
    overflow: hidden;
  }

  canvas {
    position:absolute;left:0;top:0;width:100%;height:100%;display:block;
  }

  .blur-target { position: absolute; inset:0; z-index: 1; }

  .bg-toggle {
    position:absolute; top:18px; right:18px; z-index:80; display:flex; align-items:center; gap:10px;
  }

  .flower-btn {
    width:46px; height:46px; border-radius:12px; border:none; background: rgba(255,255,255,0.06);
    color:white; font-size:20px; display:flex; align-items:center; justify-content:center;
    cursor:pointer; box-shadow: 0 6px 20px rgba(0,0,0,0.45); transition:transform .12s, background .12s;
  }
  .flower-btn:active{ transform: scale(.96) }
  .flower-btn:hover{ background: rgba(255,255,255,0.09) }

  .bg-menu {
    position:absolute; top:64px; right:0; min-width:240px; background: rgba(8,8,8,0.72);
    border-radius:12px; padding:10px; display:grid; gap:8px; box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    transform-origin: top right; opacity:0; pointer-events:none; transform: translateY(-6px) scale(.98);
    transition: opacity .16s ease, transform .16s ease; backdrop-filter: blur(6px);
  }
  .bg-menu.open { opacity:1; pointer-events:auto; transform: translateY(0) scale(1); }

  .bg-option { display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; cursor:pointer; background: rgba(255,255,255,0.02); transition: all 0.2s ease; }
  .bg-option:hover{ background: rgba(255,255,255,0.04); transform: translateY(-2px); }
  .bg-option .dot { width:36px;height:36px;border-radius:8px; flex-shrink:0; box-shadow: 0 6px 18px rgba(0,0,0,0.55); }
  .bg-option .label { font-size:14px; color:#fff; opacity:.95 }

  .hint {
    position:absolute; left:18px; bottom:18px; z-index:50;
    background: rgba(0,0,0,0.35); padding:8px 12px; border-radius:999px; font-size:13px; color:#fff; opacity:.9;
  }

  #overlay {
    position:absolute; inset:0; z-index:200; display:flex; align-items:center; justify-content:center;
    pointer-events:none; opacity:0; transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  #overlay.active { opacity:1; pointer-events:auto; }

  .overlay-inner {
    width: min(460px, 92vw); max-width: 92vw;
    display:flex; flex-direction:column; align-items:center; gap:20px;
    padding: 32px; border-radius:16px; background: rgba(0,0,0,0.7);
    backdrop-filter: blur(16px); box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    border: 1px solid rgba(255,255,255,0.08);
    transform: scale(0.95); opacity: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  #overlay.active .overlay-inner {
    transform: scale(1); opacity: 1;
  }

  .spinner {
    width:52px; height:52px; border-radius:50%;
    border:3px solid rgba(255,255,255,0.1);
    border-top-color: rgba(255,255,255,0.8);
    animation: spin 0.8s cubic-bezier(0.4, 0, 0.2, 1) infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .loading-text { font-size:15px; opacity:.95; }

  .button-row {
    display:flex; gap:14px; align-items:center; justify-content:center; flex-wrap:wrap;
  }

  .btn-main {
    padding:16px 32px; border-radius:8px; border:none; cursor:pointer;
    font-weight:500; font-size:14px;
    color:#fff; background: rgba(255,255,255,0.08); 
    border: 1px solid rgba(255,255,255,0.12);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(4px);
  }
  .btn-main:hover {
    background: rgba(255,255,255,0.12);
    border-color: rgba(255,255,255,0.18);
    transform: translateY(-1px);
  }

  .btn-alt {
    padding:16px 32px; border-radius:8px; border:none; cursor:pointer;
    font-weight:500; font-size:14px; 
    color:#fff; background: rgba(255,255,255,0.08); 
    border: 1px solid rgba(255,255,255,0.12);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(4px);
  }
  .btn-alt:hover {
    background: rgba(255,255,255,0.12);
    border-color: rgba(255,255,255,0.18);
    transform: translateY(-1px);
  }

  .btn-back {
    margin-top:8px; padding:8px 18px; font-size:12px; border-radius:8px; background: rgba(255,255,255,0.08);
    color:#fff; border:none; cursor:pointer; transition: all 0.2s ease;
  }
  .btn-back:hover {
    background: rgba(255,255,255,0.12);
  }

  .blur-target.blur { filter: blur(8px) saturate(.9); transition: filter 0.4s cubic-bezier(0.4, 0, 0.2, 1); pointer-events:none; }

  @media (max-width:520px) {
    .overlay-inner { padding: 24px }
    .spinner { width:48px; height:48px; }
  }

  body.preset-0 { background: #000; }
</style>
</head>
<body class="preset-0">
  <div class="app" id="app">

    <div class="blur-target" id="blurTarget">
      <canvas id="canvas"></canvas>
    </div>

    <div class="bg-toggle" id="bgToggle">
      <button id="flowerBtn" class="flower-btn" aria-expanded="false" title="Background presets">ðŸŒ¸</button>
      <div id="bgMenu" class="bg-menu" aria-hidden="true"></div>
    </div>

    <div class="hint">Triple-tap center to open</div>

    <div id="overlay" aria-hidden="true">
      <div class="overlay-inner" role="dialog" aria-modal="true" aria-label="Loading and actions">
        <div id="spinner" class="spinner" aria-hidden="false"></div>
        <div id="loadingText" class="loading-text">Loadingâ€¦</div>

        <div id="buttonArea" style="display:none; width:100%; align-items:center; justify-content:center; flex-direction:column;">
          <div class="button-row" style="margin-bottom:8px;">
            <button id="membersBtn" class="btn-main" type="button">Members</button>
            <button id="projectBtn" class="btn-alt" type="button">Project</button>
          </div>
          <button id="backBtn" class="btn-back" type="button">Back</button>
        </div>
      </div>
    </div>

  </div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let DPR = Math.max(1, window.devicePixelRatio || 1);

function setSize() {
  DPR = Math.max(1, window.devicePixelRatio || 1);
  canvas.width = Math.floor(window.innerWidth * DPR);
  canvas.height = Math.floor(window.innerHeight * DPR);
  canvas.style.width = window.innerWidth + 'px';
  canvas.style.height = window.innerHeight + 'px';
  ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
}
setSize();
window.addEventListener('resize', () => { setSize(); rebuildParticles(); updateCenterForParticles(); });

let particles = [];
let angle = 0;
let mouseX = -9999, mouseY = -9999;

const NUM_RINGS = 50;
const MIN_PARTICLE_SEP = 4;
const MAX_PARTICLES_LIMIT = 8000;
let totalParticlesCount = 0;

const RETURN_SPEED = 0.03;

function rebuildParticles() {
  particles = [];
  const w = window.innerWidth;
  const h = window.innerHeight;
  const centerX = w / 2;
  const centerY = h / 2;
  const maxRadius = Math.min(w, h) * 0.28;

  let total = 0;
  const perRing = [];
  for (let r = 0; r < NUM_RINGS; r++) {
    const radius = ((r + 1) / NUM_RINGS) * maxRadius;
    const circumference = 2 * Math.PI * radius;
    const count = Math.max(Math.floor(circumference / MIN_PARTICLE_SEP), 8);
    perRing.push(count);
    total += count;
    if (total > MAX_PARTICLES_LIMIT) break;
  }

  for (let r = 0; r < perRing.length; r++) {
    const radius = ((r + 1) / NUM_RINGS) * maxRadius;
    const count = perRing[r];
    for (let i = 0; i < count; i++) {
      const a = (i / count) * Math.PI * 2;
      const x = centerX + Math.cos(a) * radius;
      const y = centerY + Math.sin(a) * radius;
      const p = {
        x, y,
        size: Math.random() * 0.9 + 0.35,
        color: Math.random() > 0.86 ? '#ff6b9d' : '#ffc0cb',
        radius,
        angleOffset: a,
        centerX, centerY
      };
      particles.push(p);
    }
  }
  totalParticlesCount = particles.length;
}
rebuildParticles();

function updateCenterForParticles() {
  const cx = window.innerWidth / 2;
  const cy = window.innerHeight / 2;
  particles.forEach(p => { p.centerX = cx; p.centerY = cy; });
}

const presets = (function(){
  const presetsArr = [];

  presetsArr.push({
    id: 'classic-black',
    label: 'Classic Black',
    dot: '#000000',
    draw: function() {
      ctx.fillStyle = '#000';
      ctx.fillRect(0,0,window.innerWidth, window.innerHeight);
    }
  });

  presetsArr.push({
    id: 'deep-gradient',
    label: 'Deep Radial Gradient',
    dot: '#041926',
    draw: function() {
      const w = window.innerWidth, h = window.innerHeight;
      const g = ctx.createRadialGradient(w*0.5,h*0.45,40,w*0.5,h*0.45, Math.max(w,h));
      g.addColorStop(0,'#071926');
      g.addColorStop(0.5,'#001827');
      g.addColorStop(1,'#000');
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);
    }
  });

  presetsArr.push({
    id: 'soft-noise',
    label: 'Soft Noise + Vignette',
    dot: '#0b1b2b',
    draw: function() {
      const w = window.innerWidth, h = window.innerHeight;
      const g = ctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0,'#041120');
      g.addColorStop(1,'#001019');
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      const vg = ctx.createRadialGradient(w/2,h/2, Math.min(w,h)/6, w/2,h/2, Math.max(w,h));
      vg.addColorStop(0,'rgba(255,255,255,0)');
      vg.addColorStop(1,'rgba(0,0,0,0.45)');
      ctx.fillStyle = vg;
      ctx.fillRect(0,0,w,h);

      ctx.globalAlpha = 0.035;
      for (let i=0;i<90;i++){
        const x = Math.random()*w;
        const y = Math.random()*h;
        const r = Math.random()*1.6;
        ctx.beginPath();
        ctx.fillStyle = '#ffffff';
        ctx.arc(x,y,r,0,Math.PI*2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;
    }
  });

  presetsArr.push({
    id: 'starfield',
    label: 'Subtle Starfield',
    dot: '#001628',
    draw: (function(){
      const stars = [];
      const cacheSize = 220;
      let inited = false;
      return function(){
        const w = window.innerWidth, h = window.innerHeight;
        if (!inited){
          stars.length = 0;
          for (let i=0;i<cacheSize;i++){
            stars.push({
              x: Math.random()*w,
              y: Math.random()*h,
              r: Math.random()*1.6,
              s: 0.2 + Math.random()*0.9,
              vx: (Math.random()-0.5)*0.02,
              vy: -0.02 - Math.random()*0.04
            });
          }
          inited = true;
        }
        const g = ctx.createLinearGradient(0,0,w,h);
        g.addColorStop(0,'#000814');
        g.addColorStop(1,'#00020a');
        ctx.fillStyle = g;
        ctx.fillRect(0,0,w,h);

        for (let i=0;i<stars.length;i++){
          const s = stars[i];
          s.x += s.vx; s.y += s.vy;
          if (s.y < -10) { s.x = Math.random()*w; s.y = h + 10; }
          if (s.x < -10) s.x = w + 10;
          const tw = 0.6 + Math.sin((Date.now()*0.002) + i)*0.4;
          ctx.beginPath();
          ctx.fillStyle = `rgba(255,255,255,${s.s * tw})`;
          ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
          ctx.fill();
        }
      };
    })()
  });

  presetsArr.push({
    id: 'soft-pastel',
    label: 'Soft Pastel Gradient',
    dot: '#ffd1e8',
    draw: function(){
      const w = window.innerWidth, h = window.innerHeight;
      const g = ctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0,'#0b0910');
      g.addColorStop(0.3,'#0f1724');
      g.addColorStop(1,'#041018');
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      const grad = ctx.createLinearGradient(0,0,w,0);
      grad.addColorStop(0,'rgba(255,120,180,0.06)');
      grad.addColorStop(0.5,'rgba(120,200,255,0.06)');
      grad.addColorStop(1,'rgba(160,120,255,0.06)');
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,w,h);
    }
  });

  presetsArr.push({
    id: 'glassy',
    label: 'Glassy Blur Lights',
    dot: '#072b3a',
    draw: (function(){
      const blobs = [];
      let ready = false;
      return function(){
        const w = window.innerWidth, h = window.innerHeight;
        if (!ready){
          blobs.length = 0;
          const n = 6;
          for (let i=0;i<n;i++){
            blobs.push({
              x: Math.random()*w,
              y: Math.random()*h,
              r: Math.max(w,h)*0.2 * (0.6 + Math.random()*0.6),
              vx: (Math.random()-0.5)*0.24,
              vy: (Math.random()-0.5)*0.24,
              c: `hsla(${Math.floor(Math.random()*360)},70%,60%,0.12)`
            });
          }
          ready = true;
        }
        ctx.fillStyle = '#02060a';
        ctx.fillRect(0,0,window.innerWidth, window.innerHeight);

        for (let b of blobs){
          b.x += b.vx; b.y += b.vy;
          if (b.x < -b.r) b.x = window.innerWidth + b.r;
          if (b.x > window.innerWidth + b.r) b.x = -b.r;
          if (b.y < -b.r) b.y = window.innerHeight + b.r;
          if (b.y > window.innerHeight + b.r) b.y = -b.r;

          const rg = ctx.createRadialGradient(b.x, b.y, b.r*0.1, b.x, b.y, b.r);
          rg.addColorStop(0, b.c);
          rg.addColorStop(1, 'rgba(0,0,0,0)');
          ctx.globalCompositeOperation = 'lighter';
          ctx.fillStyle = rg;
          ctx.beginPath();
          ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
          ctx.fill();
          ctx.globalCompositeOperation = 'source-over';
        }
      };
    })()
  });

  return presetsArr;
})();

let presetIndex = 0;
function drawBackground() {
  const preset = presets[presetIndex];
  if (preset && preset.draw) {
    preset.draw();
  } else {
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0,window.innerWidth,window.innerHeight);
  }
}

function updateAndDrawParticles() {
  const maxDist = 220;

  for (let i = 0; i < particles.length; i++) {
    const p = particles[i];

    const tx = p.centerX + Math.cos(angle + p.angleOffset) * p.radius;
    const ty = p.centerY + Math.sin(angle + p.angleOffset) * p.radius;

    const dx = mouseX - p.x;
    const dy = mouseY - p.y;
    const dist = Math.sqrt(dx*dx + dy*dy);

    if (dist < maxDist && dist > 0) {
      const force = (maxDist - dist) / maxDist;
      const repelX = (p.x - mouseX) / dist;
      const repelY = (p.y - mouseY) / dist;
      p.x += repelX * force * 28;
      p.y += repelY * force * 28;
    }

    p.x += (tx - p.x) * RETURN_SPEED;
    p.y += (ty - p.y) * RETURN_SPEED;

    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
    ctx.fillStyle = p.color;
    ctx.fill();
  }
}

let rafId = null;
function loop() {
  ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
  drawBackground();
  angle += 0.0055;
  updateAndDrawParticles();
  rafId = requestAnimationFrame(loop);
}
rafId = requestAnimationFrame(loop);

canvas.addEventListener('mousemove', (e) => { mouseX = e.clientX; mouseY = e.clientY; });
canvas.addEventListener('mouseleave', () => { mouseX = -9999; mouseY = -9999; });

canvas.addEventListener('touchstart', (e) => {
  if (e.touches && e.touches[0]) {
    mouseX = e.touches[0].clientX;
    mouseY = e.touches[0].clientY;
  }
}, { passive: true });

canvas.addEventListener('touchmove', (e) => {
  if (e.touches && e.touches[0]) {
    mouseX = e.touches[0].clientX;
    mouseY = e.touches[0].clientY;
  }
}, { passive: true });

canvas.addEventListener('touchend', (e) => {
  mouseX = -9999; mouseY = -9999;
}, { passive: true });

const overlay = document.getElementById('overlay');
const spinner = document.getElementById('spinner');
const loadingText = document.getElementById('loadingText');
const buttonArea = document.getElementById('buttonArea');
const membersBtn = document.getElementById('membersBtn');
const projectBtn = document.getElementById('projectBtn');
const backBtn = document.getElementById('backBtn');
const blurTarget = document.getElementById('blurTarget');

let tapTimes = [];
const TAP_MAX_INTERVAL = 600;
function isCenterTap(x, y) {
  const rect = canvas.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;
  const dx = x - cx, dy = y - cy;
  const dist = Math.hypot(dx, dy);
  const CENTER_RADIUS = Math.min(window.innerWidth, window.innerHeight) * 0.18;
  return dist <= CENTER_RADIUS;
}

canvas.addEventListener('click', (e) => {
  registerTap(e.clientX, e.clientY);
});

canvas.addEventListener('touchend', (e) => {
  const t = e.changedTouches && e.changedTouches[0];
  if (t) registerTap(t.clientX, t.clientY);
}, { passive: true });

function registerTap(clientX, clientY) {
  const now = Date.now();
  if (!isCenterTap(clientX, clientY)) {
    tapTimes = [];
    return;
  }
  tapTimes.push(now);
  tapTimes = tapTimes.filter(t => now - t <= TAP_MAX_INTERVAL);

  if (tapTimes.length >= 3) {
    tapTimes = [];
    triggerOverlaySequence();
  }
}

function triggerOverlaySequence() {
  overlay.classList.add('active');
  overlay.setAttribute('aria-hidden', 'false');
  blurTarget.classList.add('blur');

  spinner.style.display = '';
  loadingText.style.display = '';
  loadingText.textContent = 'Loadingâ€¦';
  buttonArea.style.display = 'none';

  const loadDuration = 2000 + Math.floor(Math.random() * 2001);
  setTimeout(() => {
    spinner.style.display = 'none';
    loadingText.style.display = 'none';

    buttonArea.style.display = 'flex';
    membersBtn.focus();
  }, loadDuration);
}

membersBtn.addEventListener('click', () => {
  overlay.classList.remove('active');
  overlay.setAttribute('aria-hidden', 'true');
  blurTarget.classList.remove('blur');

  window.open('https://x.com', '_blank', 'noopener,noreferrer');
});

projectBtn.addEventListener('click', () => {
  overlay.classList.remove('active');
  overlay.setAttribute('aria-hidden', 'true');
  blurTarget.classList.remove('blur');

  window.open('https://google.com', '_blank', 'noopener,noreferrer');
});

backBtn.addEventListener('click', () => {
  overlay.classList.remove('active');
  overlay.setAttribute('aria-hidden', 'true');
  blurTarget.classList.remove('blur');
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    overlay.classList.remove('active');
    overlay.setAttribute('aria-hidden', 'true');
    blurTarget.classList.remove('blur');
    closeBgMenu();
  }
});

const bgMenu = document.getElementById('bgMenu');
const flowerBtn = document.getElementById('flowerBtn');

function buildBgMenu() {
  bgMenu.innerHTML = '';
  presets.forEach((p, idx) => {
    const opt = document.createElement('div');
    opt.className = 'bg-option';
    opt.tabIndex = 0;
    opt.setAttribute('role', 'button');
    opt.setAttribute('aria-pressed', idx === presetIndex ? 'true' : 'false');

    const dot = document.createElement('div');
    dot.className = 'dot';
    dot.style.background = p.dot || '#111';
    opt.appendChild(dot);

    const label = document.createElement('div');
    label.className = 'label';
    label.textContent = p.label;
    opt.appendChild(label);

    opt.addEventListener('click', () => {
      presetIndex = idx;
      closeBgMenu();
    });

    opt.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        opt.click();
      }
    });

    bgMenu.appendChild(opt);
  });
}
buildBgMenu();

function toggleBgMenu() {
  const open = bgMenu.classList.toggle('open');
  flowerBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
  bgMenu.setAttribute('aria-hidden', (!open).toString());
}
function closeBgMenu() {
  bgMenu.classList.remove('open');
  flowerBtn.setAttribute('aria-expanded', 'false');
  bgMenu.setAttribute('aria-hidden', 'true');
}

flowerBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  toggleBgMenu();
});

document.addEventListener('click', (e) => {
  if (!bgMenu.contains(e.target) && e.target !== flowerBtn) {
    closeBgMenu();
  }
});

function initAll() {
  rebuildParticles();
  updateCenterForParticles();
  buildBgMenu();
}
initAll();

document.addEventListener('touchstart', function preventZoom(e) {
  if (e.touches && e.touches.length > 1) {
    e.preventDefault();
  }
}, { passive: false });

console.log('Particle Circle ready - Total particles:', totalParticlesCount);
</script>
</body>
</html>
